import("ModMenu/ModMenu.flow");
import("Setup/FirstTimeSetup.flow");
import("OtherMods/FindAFriend.flow");
import("OtherMods/QuickTravelPlus.flow");
import("h07_09.msg");

global bool isFieldBf;

void f007_009_shortcut_hook() {
    isFieldBf = false;

    if (!BIT_CHK(6320)) {
        FirstTimeSetup();
    }

    int mask = 0x3C; // 0b0011_1100
    if (BIT_CHK(6323)) { // View Calendar
        mask -= 4; // 0b0100
    }
    if (BIT_CHK(6325)) { // Find a Friend
        mask -= 8; // 0b1000
    }
    if (BIT_CHK(6326) && !BIT_CHK(6321)) { // Save Anywhere (Mod Menu = OFF)
        mask -= 0x10; // 0b0001_0000
    }
    if (BIT_CHK(6321)) { // Mod Menu
        mask -= 0x20; // 0b0010_0000
    }
    SEL_DEFKEY(PadButton.Circle, 6);
    SEL_DEFKEY(PadButton.Triangle, 99);
    int dormSel = MSG_SELECT(FLD_ORDER_2, DORMITORY_SHOTCUTSEL_2, mask);

    if (dormSel == 0) {
        HIT_SCRIPT_01();
    }
    else if (dormSel == 1) {
        HIT_SCRIPT_00();
    }
    else if (dormSel == 2) {
        CALL_CALENDAR();
    }
    else if (dormSel == 3) {
        HangOut();
    }
    else if (dormSel == 4) {
        FADE(FadeEffects.FadeOut, 10);
        SAVE_MENU();
        FUNCTION_000D(0);
    }
    else if (dormSel == 5) {
        ModMenuInit();
    }
    else if (dormSel == 99) {
        MenuOptions();
    }
}

void CallOriginalSquareMenu() {
    f007_009_shortcut();
} 

void HIT_SCRIPT_01_hook()
{
    int var0;
    var0 = 0;
    
    if ( GET_DAY(4, 22) && !BIT_CHK(257) )
    {
        MSG_WND_DSP();
        MSG(SANADA_CALLING);
        MSG_WND_CLS();
        return;
    }
    else if ((!BIT_CHK(5679)) || (FUNCTION_0033() == 4))
    {
        var0 = 1;
        
        if (CHK_DAYS_STARTEND(4, 21, 1, 31) && !BIT_CHK(3085))
        {
            MSG_WND_DSP();
            MSG(GOINTO_HOME);
            MSG_WND_CLS();
            FUNCTION_002D(3);
            MSG_WND_DSP();
            MSG(GOINTO_HOME_OK);
            SEL_DEFKEY(14, 1);
            
            if (SEL(INTO_HOME_SEL) != 0)
            {
                MSG_WND_CLS();
                return;
            }

            MSG_WND_CLS();
            BIT_ON(3085);
        }
    }
    

    
    if (var0 == 1)
    {
        FADE(1, 20);
        FUNCTION_000F();
        FUNCTION_001E(3, 2);
        NEXT_TIME();
    }
    else 
    {
        FADE(3, 20);
        FUNCTION_000F();
        FUNCTION_001E(3, 2);
        CALL_FIELD(7, 2, 0, 0);
    }
}
