import("ModMenu/ModMenu.flow");
import("Setup/FirstTimeSetup.flow");
import("OtherMods/FindAFriend.flow");
import("OtherMods/QuickTravelPlus.flow");
import("h06_03.msg");

global bool isFieldBf;

void f006_001_shortcut_hook() {
    isFieldBf = false;

    if (!BIT_CHK(6320)) {
        FirstTimeSetup();
    }
    
    if (BIT_CHK(3680)) {
        MSG_WND_DSP();
        
        if (BIT_CHK(4104) || BIT_CHK(311)) {
            MSG(STOP_2F);
        }
        else {
            MSG(STOP_2F_SANADA);
        }

        MSG_WND_CLS();
        return;
    }
    
    int schoolMask = 0xFFFF; // 0b1111_1111_1111_1111

    if (!BIT_CHK(6322)) { // Quick Travel = OFF
        int var6 = 0;
        switch (FLD_GET_MINOR()) {
            case 1:
                if (GET_DAY(Month.April, 7)) {
                    var6 += 2;
                    break;
                }
                else {
                    var6 += 614; // 0b0010_0110_0110
                    break;
                }
            case 3:
                var6 += 550; // 0b0010_0010_0110
                break;
            case 4:
                var6 += 582; // 0b0010_0100_0110
                break;
            case 7:
                if (GET_DAY(Month.April, 7)) {
                    var6 += 1;
                    break;
                }
                else {
                    var6 += 612; // 0b0010_0110_0100
                    break;
                }
            case 11:
                var6 += 610; // 0b0010_0110_0010
                break;
            case 2:
            case 5:
            case 16:
            case 20:
                var6 += 614; // 0b0010_0110_0110
                break;
        }

        schoolMask = (schoolMask - var6);
    }
    else { // Quick Travel = ON
        schoolMask = (schoolMask - 0x400); // 0b0100_0000_0000
    }
    
    if (BIT_CHK(6323)) { // View Calendar
        schoolMask = (schoolMask - 0x800); // 0b1000_0000_0000
    }

    if (BIT_CHK(6325)) { // Find a Friend
        schoolMask = (schoolMask - 0x1000); // 0b0001_0000_0000_0000
    }

    if (BIT_CHK(6326) && !BIT_CHK(6321)) { // Save Anywhere (Mod Menu = OFF)
        schoolMask = (schoolMask - 0x2000); // 0b0010_0000_0000_0000
    }

    if (BIT_CHK(6321)) { // Mod Menu
        schoolMask = (schoolMask - 0x8000); // 0b1000_0000_0000_0000
    }
    
    SEL_DEFKEY(PadButton.Circle, 16); // Back & Cancel
    SEL_DEFKEY(PadButton.Triangle, 99); // Triangle && Configure
    
    int selection = MSG_SELECT(FLD_ORDER, SCHOOL_SHOTCUTSELL, schoolMask);
    switch (selection) {
        case 0:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 1, 1, 0);
            break;
        case 1:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 7, 1, 0);
            break;
        case 2:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 11, 1, 0);
            break;
        case 3:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 0x10, 1, 0);
            break;
        case 4:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 20, 0, 0);
            break;
        case 5:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 4, 2, 0);
            break;
        case 6:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 3, 0, 0);
            break;
        case 7:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 5, 0, 0);
            break;
        case 8:
            FADE(3, 20);
            FUNCTION_000F();
            CALL_FIELD(6, 2, 1, 0);
            break;
        case 9:
            get_out_here();
            break;
        case 10:
            QuickTravelPlus();
            break;
        case 11:
            CALL_CALENDAR();
            break;
        case 12:
            HangOut();
            break;
        case 13:
            FADE(FadeEffects.FadeOut, 10);
            SAVE_MENU();
            FUNCTION_000D(0);
            break;
        case 15:
            ModMenuInit();
            break;
        case 16:
            MSG_WND_CLS();
            break;
        case 99:
            MenuOptions();
            break;
    }
    FUNCTION_003B();
}

void CallOriginalSquareMenu() {
    f006_001_shortcut_hook();
} 
