import("Traesto.msg");

void traesto_return()
{
	if (BIT_CHK(3123)) { // fuuka
        MSG(HUKA_ORDER_ESCAPE);
        SEL_DEFKEY(PadButton.Circle, 1);
        
        if (BIT_CHK(4104) || FLD_FUNCTION_0046()) {
            fuukaOrder = SEL(ESCAPE_SEL);
        }
        else {
            fuukaOrder = SEL(ESCAPE_SEL_G);
        }
        if (fuukaOrder == 0) {
            MSG(HUKA_ORDER_ESCAPE_GO);
            MSG_WND_CLS();
            FUNCTION_0065(0);
            BIT_ON(3193);
            return_to_entrance();
            return;
        }

        MSG(HUKA_ORDER_RESTART);
        goto FUUKA_RESTART;
	}
	
	else { // midsuru
        MSG(HUKA_ORDER_ESCAPE);
        SEL_DEFKEY(PadButton.Circle, 1);
        
        if (BIT_CHK(4104) || FLD_FUNCTION_0046()) {
            fuukaOrder = SEL(ESCAPE_SEL);
        }
        else {
            fuukaOrder = SEL(ESCAPE_SEL_G);
        }
        if (fuukaOrder == 0) {
            MSG(HUKA_ORDER_ESCAPE_GO);
            MSG_WND_CLS();
            FUNCTION_0065(0);
            BIT_ON(3193);
            return_to_entrance();
            return;
        }

        MSG(HUKA_ORDER_RESTART);
        goto FUUKA_RESTART;
	}
}